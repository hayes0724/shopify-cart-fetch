!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var n=e();for(var s in n)("object"==typeof exports?exports:t)[s]=n[s]}}(self,(function(){return(()=>{"use strict";var t={488:(t,e,n)=>{n.r(e),n.d(e,{addItem:()=>i,addItemFromForm:()=>c,clearAttributes:()=>f,clearItems:()=>u,clearNote:()=>b,default:()=>g,getAttributes:()=>y,getNote:()=>m,getState:()=>r,removeItem:()=>h,updateAttributes:()=>p,updateItem:()=>o,updateItemById:()=>d,updateNote:()=>l});class s{constructor(t=new DocumentFragment){this.bus=t}static publish(t,e,n){return new CustomEvent(`${t}:${e}`,{detail:n})}on(t,e){this.bus.addEventListener(t,e)}emit(t,e,n){this.bus.dispatchEvent(s.publish(t,e,n))}}async function a(t,e){const n={...JSON.parse(JSON.stringify({method:"POST",credentials:"same-origin",headers:{"X-Requested-With":"XMLHttpRequest","Content-Type":"application/json;"}}))};return e&&(n.body=JSON.stringify(e)),await fetch(t,{...n}).then((t=>t.json())).then((t=>t))}async function r(){return await fetch("/cart.js").then((t=>t.json())).then((t=>t))}async function i(t){return await a("/cart/add.js",t)}async function c(t){const e=new FormData(t);if(!e.get("id"))throw"Cart form missing required property ID";return await a("/cart/add.js",e)}async function u(){return await a("/cart/clear.js")}async function o(t){return await a("/cart/change.js",t)}async function d(t){return await a("/cart/change.js",t)}async function h(t){return await a("/cart/change.js",{quantity:0,...t})}async function y(){return r().then((t=>t.attributes))}async function p(t){return await a("/cart/update.js",{attributes:{...t}})}async function f(){return r().then((t=>t.attributes)).then((t=>{const e={};return Object.getOwnPropertyNames(t).forEach((t=>e[t]="")),e})).then((t=>a("/cart/update.js",{attributes:t})))}async function m(){return r().then((t=>t.note))}async function l(t){return await a("/cart/update.js",{note:t})}async function b(){return await a("/cart/update.js",{note:""})}class g{constructor(){this.events=new s,this.findItem=t=>this.state.items.find((e=>e.key===t)),this.findItemIndex=t=>this.state.items.findIndex((e=>e.key===t)),this.getState=async()=>this.run("cart-fetch",r),this.addItem=async t=>this.runLine("cart-add",i,t),this.addItemFromForm=async t=>this.runLine("cart-add",c,t),this.clearItems=async()=>this.run("cart-update",u),this.removeItem=async t=>this.runLine("cart-remove",h,t),this.updateItem=async t=>this.runLine("cart-update",o,t),this.updateItemById=async t=>this.runLine("cart-update",d,t),this.updateAttributes=async t=>this.run("cart-update",p,t),this.clearAttributes=async()=>this.run("cart-update",f),this.getAttributes=y,this.getNote=m,this.updateNote=async t=>this.run("cart-update",l,t),this.clearNote=async()=>this.run("cart-update",b)}get state(){return this._state}set state(t){this._state=t}async run(t,e,n){return this.events.emit(t,"start"),this.state=await e(n),this.events.emit(t,"complete",this.state),this.state}async runLine(t,e,n){this.events.emit(t,"start");const s=await e(n),a=this.findItemIndex(s.key);return a>-1&&s.quantity>0?this.state.items[a]=s:this.state.items.push(s),this.events.emit(t,"complete",this.state),s}}}},e={};function n(s){if(e[s])return e[s].exports;var a=e[s]={exports:{}};return t[s](a,a.exports,n),a.exports}return n.d=(t,e)=>{for(var s in e)n.o(e,s)&&!n.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n(488)})()}));
//# sourceMappingURL=index.amd.min.js.map